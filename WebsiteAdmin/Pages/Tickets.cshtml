@page
@model TicketsModel
@{
    ViewData["Title"] = "Support Tickets";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Support Tickets</h1>
    <div>
        <form method="get" class="d-inline">
            <select name="status" class="form-select d-inline-block w-auto" onchange="this.form.submit()">
                <option value="">All Tickets</option>
                <option value="Open" selected="@(Model.StatusFilter == "Open")">Open</option>
                <option value="InProgress" selected="@(Model.StatusFilter == "InProgress")">In Progress</option>
                <option value="Closed" selected="@(Model.StatusFilter == "Closed")">Closed</option>
            </select>
        </form>
    </div>
</div>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>ID</th>
            <th>Type</th>
            <th>User</th>
            <th>Message</th>
            <th>Status</th>
            <th>Created</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var ticket in Model.Tickets)
        {
            <tr>
                <td>@ticket.Id</td>
                <td>
                    @switch (ticket.Type)
                    {
                        case Common.SupportEntryType.Error:
                            <span class="badge bg-danger">Error</span>
                            break;
                        case Common.SupportEntryType.SupportRequest:
                            <span class="badge bg-primary">Support</span>
                            break;
                        case Common.SupportEntryType.FeatureRequest:
                            <span class="badge bg-info">Feature</span>
                            break;
                        default:
                            <span class="badge bg-secondary">Unknown</span>
                            break;
                    }
                </td>
                <td>@(ticket.customer?.Email ?? ticket.customer?.PhoneNumber ?? ticket.CustomerId.ToString().Substring(0, 8))</td>
                <td>@(ticket.Message.Length > 50 ? ticket.Message.Substring(0, 50) + "..." : ticket.Message)</td>
                <td>
                    @switch (ticket.Status)
                    {
                        case Common.TicketStatus.Open:
                            <span class="badge bg-warning">Open</span>
                            break;
                        case Common.TicketStatus.InProgress:
                            <span class="badge bg-info">In Progress</span>
                            break;
                        case Common.TicketStatus.Closed:
                            <span class="badge bg-success">Closed</span>
                            break;
                    }
                </td>
                <td>@ticket.CreatedAt.ToString("dd.MM.yyyy HH:mm")</td>
                <td>
                    <a href="/TicketDetail/@ticket.Id" class="btn btn-sm btn-outline-primary">View</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Tickets.Any())
{
    <div class="alert alert-info">No tickets found.</div>
}
